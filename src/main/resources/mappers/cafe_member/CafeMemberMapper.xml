<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itbank.navercafe.mybatis.cafemember.CafeMemberMapper">

	<resultMap type="com.itbank.navercafe.user.cafemember.dto.CafeMemberDTO" id="project_cafe_member">
		<id property="cafeId" column="cafe_id"/>
		<result property="userId" column="user_id"/>
		<result property="cafeUserNickname" column="cafe_user_nickname"/>
		<result property="cafeUserImage" column="cafe_user_image"/>
		<result property="cafeUserGrade" column="cafe_user_grade"/>
		<result property="cafeUserVisit" column="cafe_user_visit"/>
		<result property="cafeUserWrite" column="cafe_user_write"/>
		<result property="cafeUserReply" column="cafe_user_reply"/>
		<result property="cafeUserVisitCheck" column="cafe_user_visit_check"/>
		<result property="cafeUserRegdate" column="cafe_user_regdate"/>
		<result property="cafeUserApplyDate" column="cafe_user_applydate"/>
		<result property="cafeUserStatus" column="cafe_user_status"/>
		<result property="cafeUserEmailReceieve" column="cafe_user_email_receieve"/>
		<result property="cafeUserGenderReveal" column="cafe_user_gender_reveal"/>
	</resultMap>
	
	<!-- 카페 닉네임 중복검사 -->
	<select id="idOverlap" resultType="Integer">
		select count(user_id) from project_cafe_member where cafe_id = #{cafeId} and cafe_user_nickname = #{cafeUserNickname}
	</select>
	<!-- 카페 회원가입 -->
	<insert id="signup">
		insert into project_cafe_member(cafe_id,user_id,cafe_user_nickname)
		values(#{cafeId},#{userId},#{cafeUserNickname})
	</insert>
	
	<select id="cafeMembers" resultType="Integer">
		select count(*) from project_cafe_member where cafe_id = #{cafeId} and user_id = #{userId}
	</select>
	
	<select id="getCafeMember" resultMap="project_cafe_member">
		select * from project_cafe_member where cafe_id = #{cafeId} and user_id = #{userId}
	</select>
	
	<update id="cafeMemberUpdate">
		update project_cafe_member set cafe_user_nickname = #{cafeUserNickname}, cafe_user_email_receieve = #{cafeUserEmailReceieve},
		cafe_user_gender_reveal = #{cafeUserGenderReveal}
		
		where cafe_id = #{cafeId} and user_id = #{userId}
	
	</update>
	
	
	<insert id="signup2">
		insert into project_cafe_join_request(cafe_request_num, cafe_id, user_id, cafe_user_nickname)
		values(cafejoin_SEQ.nextval,#{cafeId}, #{userId}, #{userNickname})
	</insert>
	
	
	
	
	
	
	
	
	<select id="getCafeMemberList" resultMap="project_cafe_member">
		select * from project_cafe_member
	</select>
	
	<insert id="saveData">
		insert into project_cafe_member(cafe_id,user_id,cafe_user_nickname,cafe_user_image)
		values(#{cafeId},#{userId},#{cafeUserNickname},#{cafeUserImage})
	</insert>
	
	<select id="getCafeUserInfo" resultMap="project_cafe_member">
		select user_id,cafe_user_nickname,cafe_user_image from project_cafe_member
		where user_id=#{userId}
	</select>
	
	<select id="getSessionUserInfo" resultMap="project_cafe_member">
		select user_id,cafe_user_nickname from project_cafe_member where user_id=#{sessionId}
	</select>
	
	
	

	
	
</mapper>